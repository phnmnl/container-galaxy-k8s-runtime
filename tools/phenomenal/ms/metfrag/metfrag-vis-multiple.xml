<?xml version='1.0' encoding='UTF-8'?>
<!--This is a configuration file for the integration of a tools into Galaxy (https://galaxyproject.org/).-->
<!--Proposed Tool Section: [PhenoMeNal]-->
<tool id="metfrag-vis-multiple" name="metfrag-vis-multiple" version="0.5">
  <description>Generate a PDF summary for MetFrag result files.</description>
  <command><![CDATA[
  	mkdir /tmp/outputdir/;
        mkdir -p "$metfrag_vis_output_1.extra_files_path";
        java -cp /usr/local/bin/MetFrag-Tools.jar de.ipbhalle.metfrag.conversion.PrepareMetFragOutputCSV csv=$metfrag_vis_input_1 scorenames=FragmenterScore,AutomatedPeakFingerprintAnnotationScore,AutomatedLossFingerprintAnnotationScore,OfflineMetFusionScore scoreweights=1.0,1.0,1.0,1.0 exclude=AutomatedLossFingerprintAnnotationScore_Probtypes,AutomatedPeakFingerprintAnnotationScore_Probtypes,AutomatedPeakFingerprintAnnotationScore_Values,AutomatedLossFingerprintAnnotationScore_Values output="$metfrag_vis_output_1.extra_files_path"/metfrag_vis_temp.csv;
        bash /usr/local/bin/visualize-metfrag-multiple.sh "$metfrag_vis_output_1.extra_files_path"/metfrag_vis_temp.csv "$metfrag_vis_output_1.extra_files_path"/metfrag_vis_temp_top1.csv;
        java -jar /usr/local/bin/ConvertMetFragCSV.jar csv="$metfrag_vis_output_1.extra_files_path"/metfrag_vis_temp_top1.csv output=/tmp/outputdir/combined_top1_cands.tex propertyWhiteList=Score,SampleName,Identifier,MolecularFormula,CompoundName,NumberPeaksUsed,NoExplPeaks,MetFragWebURL,parentMZ,parentRT format=tex;
        pdflatex -output-directory /tmp/outputdir/ /tmp/outputdir/combined_top1_cands.tex;
        mv /tmp/outputdir/combined_top1_cands.pdf $metfrag_vis_output_1;
        rm "$metfrag_vis_output_1.extra_files_path"/metfrag_vis_temp_top1.csv "$metfrag_vis_output_1.extra_files_path"/metfrag_vis_temp.csv;
        rm -rf /tmp/outputdir/;
        rm /tmp/*.png;
  ]]>
  </command>
  <inputs>
    <param name="metfrag_vis_input_1" type="data" format="csv" multiple="True" optional="False" label="MetFrag result file (multiple entries)" />
  </inputs>
  <outputs>
	<data name="metfrag_vis_output_1" type="data" format="pdf" label="Summary PDF file" />	
  </outputs>
  <help>

.. class:: infomark

| **Tool update: See the 'NEWS' section at the bottom of the page**

---------------------------------------------------

.. class:: infomark

**Authors**

| **Christoph Ruttkies (christoph.ruttkies@ipb-halle.de)** wrote and maintains this wrapper for the generation of a MetFrag summary file.

---------------------------------------------------

=====================
MetFrag-Visualization
=====================

-----------
Description
-----------

| This module is used generate a summary PDF file from a MetFrag result file with entries from multiple MS/MS peak lists. The results are usually generated by the **metfrag-cli-batch-multiple**. The generated PDF file includes the Top1 entries of each result CSV file including an image of the candidate and properties.

+-------------------------+
| predecessor tool        |
+-------------------------+
| metfrag-cli-batch-batch |
+-------------------------+

-----------
Input files
-----------

+------------------------------+------------+
| File                         |   Format   |
+==============================+============+
| 1)  MetFrag result file      |    csv     |
|     (multiple entries)       |            |
+------------------------------+------------+

----------
Parameters
----------

MetFrag result file with multiple entries
        | CSV file containing MetFrag results generated by **metfrag-cli-batch-multiple** containing the results from multiple MetFrag MS/MS peak lists
        |

------------
Output files
------------

metfrag_vis_output_1
        | Summary PDF file visualizing MetFrag results
        |

---------------------------------------------------

----
NEWS
----

CHANGES IN VERSION 0.5
========================

- changes help and description

CHANGES IN VERSION 0.4
========================

- added help and description

CHANGES IN VERSION 0.3
========================

- fixed bugs when empty result files are passed

CHANGES IN VERSION 0.1
========================

First version

  </help>
</tool>
