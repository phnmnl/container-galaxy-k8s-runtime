<tool id="isa_factors_viz" name="isa_factors_viz" version="0.5">
    <description>Produce a visualization of study factors and groups from an ISA study.</description>
    <requirements>
        <requirement type="package" version="1.10.4">r-data.table</requirement>
        <requirement type="package" version="1.5">r-jsonlite</requirement>
        <requirement type="package" version="1.4.4">r-optparse</requirement>
        <requirement type="package" version="0.2.0">r-ggparallel</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <description>Visualizes factors and its values on ISA-Tab and MetaboLights factors JSON</description>
    <command><![CDATA[
    #if $input_type_conditional.input_type == "mtbls-id"
        makeParallelCoordsPlot.R -s "$input_type_conditional.mtbls_id" -o \$PWD
    #else
        makeParallelCoordsPlot.R -i "$input_type_conditional.factors_json" -o \$PWD
    #end if

    ]]></command>
    <!-- -p, -l -s are optional; tracing data, time and experimental factor are required
     Missing -q quick mode.
     -->
    <inputs>
        <conditional name="input_type_conditional">
            <param name="input_type" type="select" label="Input Type">
                <option value="mtbls-id" selected="true">MetaboLights Study Identifier</option>
                <option value="isa-factors-json">ISA-Tab Factors table as JSON file</option>
            </param>
            <when value="mtbls-id">
                 <param name="mtbls_id" type="text" label="MetaboLights Study Identifier" help="MTBLS ID available at MetaboLights Parallel Coordinates at ftp://ftp.ebi.ac.uk/pub/databases/metabolights/derived/parallel_coordinates/"/>
            </when>
            <when value="isa-factors-json">
                 <param type="data" name="factors_json" format="json" label="ISA-Tab factors table in JSON format" />
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data name="factors_plot" format="pdf" from_work_dir="factors_plot.pdf" label="Factors Parallel Sets Plot"/>
    </outputs>
    <tests>
        <!--<test>-->
            <!--<param name="input_type" value="mtbls-id"/>-->
            <!--<param name="mtbls_id" value="MTBLS1"/>-->
            <!--<output name="factors_plot" file="example.pdf"/>-->
        <!--</test>-->
        <test>
            <param name="input_type" value="isa-factors-json"/>
            <param name="factors_json" value="example.json" ftype="json"/>
            <output name="factors_plot" file="example.pdf"/>
        </test>
    </tests>
    <help>
    <!-- @@@BEGIN_RST@@@ -->
========================================
Visualize study factors summary from ISA
========================================

This tool visualizes ISA metadata about study factors by either downloading the
factors summary directly from MetaboLights or by processing a JSON factors
table generated by the `isa_factors_summary` Galaxy tool.

-----
Input
-----

MetaboLights Study Identifier
=============================
MTBLS ID available at MetaboLights, e.g. MTBLS2.

OR

ISA-tab factors table in JSON format
====================================
Factors table as generated by `isa_factors_summary` tool.

------
Output
------

Zip file containing ISA files
=============================
Factors Parallel Sets Plot as a PDF.

    <!-- @@@END_RST@@@ -->
    </help>

    <citations>
        <citation type="doi">10.1093/nar/gks1004</citation>
        <citation type="doi">10.5281/zenodo.163640</citation>
        <citation type="doi">10.1038/ng.1054</citation>
    </citations>

</tool>