<macros>

    <token name="@VERSION@">1.2.0</token>

    <xml name="requirements">
        <requirements>
            <requirement type="package" version="6.7">click</requirement>
            <!--<requirement type="package" version="0.9.5">isatools</requirement>-->
        </requirements>
    </xml>

    <xml name="stdio">
        <stdio>
            <exit_code range="1:" />
            <exit_code range=":-1" />
        </stdio>
    </xml>

    <xml name="configfiles">
        <configfiles>
            <inputs name="inputs" />
        </configfiles>
    </xml>

    <xml name="study_metadata">
        <section name="study_metadata" title="Study Overview Metadata">
            <param name="title" type="text" label="Study Title" value="Study Title" help="e.g. Metabolomics study of the effect of ... on ..."/>
            <param name="description" area="True" size="5x25" value="Study Description" type="text" label="Study Description" help="e.g. The study of... by means of metabolite profiling using ..."/>
            <param name="first_name" type="text" label="Study PI First Name" value="First name"  help="e.g. Marie"/>
            <param name="last_name" type="text" label="Study PI Last Name" value="Last Name"  help="e.g. Sklodowska Curie"/>
            <param name="email" type="text" label="Study PI Email Address" value="email@email.com" help="e.g. marie.sklodowska-curie@gmail.com">
                <validator type="regex" message="Must look like a valid email adddress">(^$|^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$)</validator>
            </param>
            <param name="affiliation" type="text" label="Study PI Affiliation" value="Affiliation" help="e.g. Radium Institute, Paris"/>
            <param name="study_consent" type="select" label="Consent Information (ICO:0000011)">
                <options from_data_table="isa_cvterms">
                    <column name="value" index="1"/>
                    <filter type="static_value" column="2" value="consent"/>
                    <filter type="add_value" value="user_defined_consent_information"/>
                </options>
            </param>
            <param name="study_use_condition" type="select" label="Data Use Requirement (DUO:0000017)">
                <options from_data_table="isa_cvterms">
                    <column name="value" index="1"/>
                    <filter type="static_value" column="2" value="data use requirement"/>
                    <filter type="add_value" value="user_defined_data_use_requirement"/>
                </options>
            </param>
        </section>
    </xml>

    <xml name="treatment_plan">
        <section name="treatment_plan" title="Treatment Plan">
            <conditional name="study_type">
                <param name="study_type_selector" type="select" label="Type of Study" help="See examples in help section below.">
                    <option value="full_factorial_intervention">full factorial intervention</option>
                    <option value="fractional_factorial_intervention">fractional factorial intervention</option>
                    <option value="observation">observation</option>
                </param>
                <when value="full_factorial_intervention">
                    <conditional name="multiple_interventions">
                        <param name="multiple_interventions_selector" type="select" label="Single or multiple interventions?">
                            <option value="single" selected="True">single</option>
                            <option value="multiple">multiple</option>
                        </param>
                        <when value="single">
                            <param name="group_size" type="text" label="Group Size" value="3">
                                <validator type="in_range" min="1" max="1000" message="Study group size must be less than 1000."/>
                            </param>
                            <conditional name="intervention_type">
                                <param name="intervention_type_selector" type="select" label="Intervention Type">
                                    <option value="chemical intervention" selected="True">chemical intervention</option>
                                    <option value="dietary intervention">dietary intervention</option>
                                    <option value="behavioural intervention">behavioral intervention</option>
                                    <option value="biological intervention">biological intervention</option>
                                    <option value="surgical intervention">surgical intervention</option>
                                </param>
                                <when value="chemical intervention">
                                    <param name="agent" type="text" value="aspirin,ibuprofen,morphine"/>
                                    <param name="intensity" type="text" value="low dose,moderate dose,high dose"/>
                                    <param name="duration" type="text" value="t0,t1,t2"/>
                                </when>
                                <when value="behavioural intervention">
                                    <param name="agent" type="text" value="physical activity,speech therapy"/>
                                    <param name="intensity" type="text" value="low intensity,moderate intensity,high intensity"/>
                                    <param name="duration" type="text" value="t0,t1,t2"/>
                                </when>
                                <when value="biological intervention">
                                    <param name="agent" type="text" value="viral strain a, viral strain b"/>
                                    <param name="intensity" type="text" value="low dose,moderate dose,high dose"/>
                                    <param name="duration" type="text" value="t0,t1,t2"/>
                                </when>
                                <when value="surgical intervention">
                                    <param name="agent" type="text" value="procedure 1,procedure 2"/>
                                    <param name="intensity" type="text" value="standard"/>
                                    <param name="duration" type="text" value="t0,t1,t2"/>
                                </when>
                                <when value="dietary intervention">
                                    <param name="agent" type="text" value="vitamin supplementation,caloric restriction,food composition variation"/>
                                    <param name="intensity" type="text" value="low,moderate,high"/>
                                    <param name="duration" type="text" value="t0,t1,t2"/>
                                </when>
                            </conditional>
                        </when>
                        <when value="multiple">
                            <param name="group_size" type="text" label="Group Size" value="3">
                                <validator type="in_range" min="1" max="1000" message="Study group size must be less than 1000."/>
                            </param>
                            <repeat name="multiple_intervention" title="Multiple Intervention">
                                <conditional name="intervention_type">
                                    <param name="intervention_type_selector" type="select" label="Intervention Type">
                                        <option value="chemical intervention" selected="True">chemical intervention</option>
                                        <option value="dietary intervention">dietary intervention</option>
                                        <option value="behavioural intervention">behavioral intervention</option>
                                        <option value="biological intervention">biological intervention</option>
                                        <option value="surgical intervention">surgical intervention</option>
                                    </param>
                                    <when value="chemical intervention">
                                        <param name="agent" type="text" value="aspirin,ibuprofen,morphine"/>
                                        <param name="intensity" type="text" value="low dose,moderate dose,high dose"/>
                                        <param name="duration" type="text" value="t0,t1,t2"/>
                                    </when>
                                    <when value="behavioural intervention">
                                        <param name="agent" type="text" value="physical activity,speech therapy"/>
                                        <param name="intensity" type="text" value="low intensity,moderate intensity,high intensity"/>
                                        <param name="duration" type="text" value="t0,t1,t2"/>
                                    </when>
                                    <when value="biological intervention">
                                        <param name="agent" type="text" value="viral strain a, viral strain b"/>
                                        <param name="intensity" type="text" value="low dose,moderate dose,high dose"/>
                                        <param name="duration" type="text" value="t0,t1,t2"/>
                                    </when>
                                    <when value="surgical intervention">
                                        <param name="agent" type="text" value="procedure 1,procedure 2"/>
                                        <param name="intensity" type="text" value="standard"/>
                                        <param name="duration" type="text" value="t0,t1,t2"/>
                                    </when>
                                    <when value="dietary intervention">
                                        <param name="agent" type="text" value="vitamin supplementation,caloric restriction,food composition variation"/>
                                        <param name="intensity" type="text" value="low,moderate,high"/>
                                        <param name="duration" type="text" value="t0,t1,t2"/>
                                    </when>
                                </conditional>
                             </repeat>
                        </when>
                    </conditional>
                </when>
                <when value="fractional_factorial_intervention">
                    <conditional name="balance">
                        <param name="balanced_groups" type="boolean" label="Balanced groups?" checked="true"/>
                        <when value="true">
                            <conditional name="multiple_intervention">
                                <param name="multiple_interventions_selector" type="select" label="Single or multiple interventions?">
                                    <option value="single" selected="True">single</option>
                                    <option value="multiple">multiple</option>
                                </param>
                                <when value="single">
                                    <param name="group_size" type="text" label="Group Size" value="3" help="The group size specified here will be applied to all study groups.">
                                        <validator type="in_range" min="1" max="1000" message="Study group size must be less than 1000."/>
                                    </param>
                                    <param name="intervention_type_selector" type="select" label="Intervention Type">
                                        <option value="chemical intervention" selected="True">chemical intervention</option>
                                        <option value="dietary intervention">dietary intervention</option>
                                        <option value="behavioural intervention">behavioral intervention</option>
                                        <option value="biological intervention">biological intervention</option>
                                        <option value="surgical intervention">surgical intervention</option>
                                    </param>
                                    <param name="study_factors" type="text" label="Study factors" value="agent, intensity, duration"/>
                                    <repeat name="study_groups" title="Study group">
                                        <param name="factor_values" type="text" label="Factor values" value="aspirin, low dose, t0"/>
                                    </repeat>
                                </when>
                                <when value="multiple">
                                    <param name="group_size" type="text" label="Group Size" value="3">
                                        <validator type="in_range" min="1" max="1000" message="Study group size must be less than 1000."/>
                                    </param>
                                    <repeat name="multiple_intervention" title="Multiple intervention">
                                        <param name="intervention_type_selector" type="select" label="Intervention Type">
                                            <option value="chemical intervention" selected="True">chemical intervention</option>
                                            <option value="dietary intervention">dietary intervention</option>
                                            <option value="behavioural intervention">behavioral intervention</option>
                                            <option value="biological intervention">biological intervention</option>
                                            <option value="surgical intervention">surgical intervention</option>
                                        </param>
                                        <param name="study_factors" type="text" label="Study Factors" value="agent, intensity, duration"/>
                                        <repeat name="study_groups" title="Study Group">
                                            <param name="factor_values" type="text" label="Factor Values" value="aspirin, low dose, t0"/>
                                        </repeat>
                                     </repeat>
                                </when>
                            </conditional>
                        </when>
                        <when value="false">
                            <conditional name="multiple_intervention">
                                <param name="multiple_interventions_selector" type="select" label="Single or multiple interventions?">
                                    <option value="single" selected="True">single</option>
                                    <option value="multiple">multiple</option>
                                </param>
                                <when value="single">
                                    <param name="intervention_type_selector" type="select" label="Intervention type">
                                        <option value="chemical intervention" selected="True">chemical intervention</option>
                                        <option value="dietary intervention">dietary intervention</option>
                                        <option value="behavioural intervention">behavioral intervention</option>
                                        <option value="biological intervention">biological intervention</option>
                                        <option value="surgical intervention">surgical intervention</option>
                                    </param>
                                    <param name="study_factors" type="text" label="Study Factors" value="agent, intensity, duration"/>
                                    <repeat name="study_groups" title="Study group">
                                        <param name="factor_values" type="text" label="Factor Values" value="aspirin, low dose, t0"/>
                                        <param name="group_size" type="text" label="Group Size" value="3">
                                            <validator type="in_range" min="1" max="1000" message="Study group size must be less than 1000."/>
                                        </param>
                                    </repeat>
                                </when>
                                <when value="multiple">
                                    <repeat name="multiple_intervention" title="Multiple Intervention">
                                        <param name="intervention_type_selector" type="select" label="Intervention type">
                                        <option value="chemical intervention" selected="True">chemical intervention</option>
                                        <option value="dietary intervention">dietary intervention</option>
                                        <option value="behavioural intervention">behavioral intervention</option>
                                        <option value="biological intervention">biological intervention</option>
                                        <option value="surgical intervention">surgical intervention</option>
                                    </param>
                                        <param name="study_factors" type="text" label="Study Factors" value="agent, intensity, duration"/>
                                        <repeat name="study_groups" title="Study group">
                                            <param name="factor_values" type="text" label="Factor Values" value="aspirin, low dose, t0"/>
                                            <param name="group_size" type="text" label="Group Size" value="3">
                                                <validator type="in_range" min="1" max="1000" message="Study group size must be less than 1000."/>
                                            </param>
                                        </repeat>
                                     </repeat>
                                </when>
                            </conditional>
                        </when>
                    </conditional>
                </when>
                <when value="observation"/>
            </conditional>
        </section>
    </xml>

    <xml name="qc_plan">
        <section name="qc_planning" title="Quality Control / Quality Assurance Plan">
            <repeat name="qc_plans" title="Quality Control / Quality Assurance Plan">
                <param name="material_type" type="select" label="Material Type">
                    <options from_data_table="isa_cvterms">
                        <column name="value" index="1"/>
                        <filter type="static_value" column="2" value="QC terms"/>
                    </options>
                </param>
                <conditional name="qc_type">
                    <param name="qc_type_selector" type="select" label="QC Type">
                        <option value="interval_series" selected="True">interval series</option>
                        <option value="pre_dilution_series">dilution series (pre-run batch)</option>
                        <option value="post_dilution_series">dilution series (post-run batch)</option>
                    </param>
                    <when value="interval_series">
                        <param name="injection_frequency" type="integer" label="Injection Frequency" value="10">
                            <validator type="in_range" min="1" exclude_min="true" message="Injection frequency must be more than 1."/>
                        </param>
                    </when>
                    <when value="pre_dilution_series">
                        <param name="quantity_type" type="text" label="Quantity Type" value="Amount in ml"/>
                        <param name="values" type="text" label="Values (comma-separated)" value="1,3,5,10"/>
                    </when>
                    <when value="post_dilution_series">
                        <param name="quantity_type" type="text" label="Quantity Type" value="Amount in ml"/>
                        <param name="values" type="text" label="Quantity (comma-separated)" value="10,5,3,1"/>
                    </when>
                </conditional>
            </repeat>
        </section>
    </xml>

    <xml name="output_isa-tab">
        <data format="isa-tab" name="output" label="New ISA-Tab"/>
    </xml>

    <xml name="output_collections">
        <collection type="list" label="ISA files" name="isa_files">
            <discover_datasets pattern="(?P&lt;designation&gt;(i|s|a)_.+)\.txt" directory="study_dir"  format="tsv"/>
        </collection>
        <collection type="list" label="Data files" name="raw_files">
            <discover_datasets pattern="(?P&lt;designation&gt;.+)\.(zip|gz|mzml|nmrml)"/>
        </collection>
    </xml>

    <token name="@ISATOOLS_LOGO@"><![CDATA[
.. image:: https://i0.wp.com/isa-tools.org/wp-content/uploads/2016/10/isatools_logo-1.png?zoom=1.25&fit=688%2C164
            :height: 25
            :width: 95
            :target: http://www.isa-tools.org
]]></token>

    <token name="@ISACREATE_METABO_HELP@"><![CDATA[

What it does
------------

This tool helps create ISA documents using essential study design information.
Suppose you have a study like this one:

A study looking at the effect of drugs A and B administered at high and low
dose with plasma samples collected at 3 times points, and done in n=5 subjects
per treatment groups.

The response variables are metabolite profiles measured by
liquid-chromatography mass spectrometry (LC-MS), in positive and negative
modes, on an instance of Thermofisher :sup:`®` acquisition platform.

Key descriptors can be extracted and formalized as described below:

Formalization
-------------

    #. study type:
        a) intervention study (note: observation studies not yet supported)
    #. single intervention:
        a) chemical intervention:
            * independent variable:
                * chemical _ agent range of values: [a,b].
            * independent variable:
                * dose _ range of values: [high,low].
            * independent variable:
                * time _ range of values: [t1,t2,t3].

    .. class:: warningmark

Important: specify the values of independent variables as discrete elements, in a comma (,) separated list, as shown in the examples provided.

    #. study design:
        * 2x2x3 factorial.
    #. study design:
        * balanced + full factorial.
    #. number of biological replicates:
        * n=5 per study groups.
    #. specimen collection:
        (i) specimen type: [plasma].
        (ii)  number of collection: 3.
    #. assay plan:
        a) technology type:
            (i)   MS
        b) assay topology modifiers:
            (i)  injection method: [LC].
            (ii)  fractions: [polar,non-polar].
            (iii)  data acquisition modes: [negative,positive].
            (iv) instrument type: ThermoFisher 'Thermo Scientific LTQ Orbitrap'.
            (v) instrument instance: 1.
            (vi) technical replicates: 2.
            (vii) number of batches: 1.

]]></token>

    <token name="@ISACREATE_GENOMICS_HELP@"><![CDATA[

What it does
------------

This tool helps create ISA documents using essential study design information.
Suppose you have a study like this one:

A study looking at the effect of drugs A and B administered at high and low
dose with plasma samples collected at 3 times points, and done in n=5 subjects
per treatment groups.

Update this help doc for use with ISA Create Genomics.

Key descriptors can be extracted and formalized as described below:

Formalization
-------------

    #. study type:
        a) intervention study (note: observation studies not yet supported)
    #. single intervention:
        a) chemical intervention:
            * independent variable:
                * chemical _ agent range of values: [a,b].
            * independent variable:
                * dose _ range of values: [high,low].
            * independent variable:
                * time _ range of values: [t1,t2,t3].

    .. class:: warningmark

Important: specify the values of independent variables as discrete elements, in a comma (,) separated list, as shown in the examples provided.

    #. study design:
        * 2x2x3 factorial.
    #. study design:
        * balanced + full factorial.
    #. number of biological replicates:
        * n=5 per study groups.
    #. specimen collection:
        (i) specimen type: [plasma].
        (ii)  number of collection: 3.
    #. assay plan:
        a) technology type:
            (i)  DNA sequencing
            (ii) DNA microarray


]]></token>

    <token name="@STATO_PLUG@"><![CDATA[
All the study design related information is semantically marked up using terms from STATO, the ontology for statistical methods and measures.

.. image:: https://raw.github.com/ISA-tools/stato/dev/images/stato-logo-1.png
    :height: 40
    :width: 90
    :target: http://stato-ontology.org
]]></token>

    <token name="@ISATOOLS_DOCS@">https://isatools.readthedocs.io</token>
    <token name="@ISATOOLS_GITHUB@">https://github.com/ISA-tools/isa-api/</token>

    <xml name="citations">
        <citations>
            <citation type="doi">10.1007/s11306-015-0879-3</citation>
        </citations>
    </xml>

    <xml name="sample_assay_plan_metabo">
        <section name="sample_and_assay_planning" title="Sampling and Assay Plans">
            <repeat name="sample_plans" title="Sampling Plan">
                <param name="material_type" type="select" min="1" label="Sample Material Type">
                    <options from_data_table="isa_cvterms">
                        <column name="value" index="1"/>
                        <filter type="static_value" column="2" value="animal_mat"/>
                        <filter type="add_value" value="user_defined_sample_type"/>
                    </options>
                </param>
                <param name="sample_collections" type="integer" label="Number of Sample Collections" value="1"/>
                <repeat name="assay_plans" title="Assay Plan">
                    <conditional name="assay_type">
                        <param name="assay_type_selector" type="select" label="Assay type">
                            <option value="ms" selected="True">mass spectrometry</option>
                            <option value="nmr">nmr spectroscopy</option>
                        </param>
                        <when value="ms">
                            <repeat name="sample_fractions" title="Sample Fractions">
                                <param name="sample_fraction" type="select" min="1" label="Sample Fraction of Interest">
                                    <option value="polar"/>
                                    <option value="non-polar" selected="True"/>
                                </param>
                            </repeat>
                            <repeat name="injections" title="Injection Series">
                                <conditional name="injection_mode">
                                    <param name="injection_mode_selector" type="select" min="1" label="Sample Introduction Method">
                                        <option value="DI">direct infusion</option>
                                        <option value="FIA" selected="True">flow infusion assay</option>
                                        <option value="LC">liquid chromatography</option>
                                        <option value="GC">gas chromatography</option>
                                    </param>
                                    <when value="DI">
                                        <param name="instrument" type="select" min="1" label="MS Instrument">
                                            <options from_data_table="isa_cvterms">
                                                <column name="value" index="1"/>
                                                <filter type="static_value" column="2" value="mass spectrometry instrument"/>
                                                <filter type="add_value" value="user_defined_ms_instrument"/>
                                            </options>
                                            <option value="none reported">none reported</option>
                                        </param>
                                        <repeat name="acquisitions"  title="Acquisition Series">
                                            <param name="acquisition_mode" type="select" min="1" label="Acquisition Mode">
                                                <option value="negative" selected="True"/>
                                                <option value="positive"/>
                                                <option value="positive/negative"/>
                                            </param>
                                            <param name="technical_replicates" type="integer" label="Number of Technical Replicates" value="1">
                                                <validator type="in_range" message="Technical replicates must be more than 0 and less than 3" min="0" exclude_min="true" max="3"/>
                                            </param>
                                        </repeat>
                                    </when>
                                    <when value="FIA">
                                        <param name="instrument" type="select" min="1" label="MS Instrument">
                                            <options from_data_table="isa_cvterms">
                                                <column name="value" index="1"/>
                                                <filter type="static_value" column="2" value="mass spectrometry instrument"/>
                                                <filter type="add_value" value="user_defined_ms_instrument"/>
                                            </options>
                                            <option value="none reported">none reported</option>
                                        </param>
                                        <repeat name="acquisitions"  title="Acquisition Series">
                                            <param name="acquisition_mode" type="select" min="1" label="Acquisition Mode">
                                                <option value="negative" selected="True"/>
                                                <option value="positive"/>
                                                <option value="positive/negative"/>
                                            </param>
                                            <param name="technical_replicates" type="integer" label="Number of Technical Replicates" value="1">
                                                <validator type="in_range" message="Technical replicates must be more than 0 and less than 3" min="0" exclude_min="true" max="3"/>
                                            </param>
                                        </repeat>
                                    </when>
                                    <when value="LC">
                                        <param name="chromatography_column" type="select" min="1" label="Chromatography Column">
                                            <option value="none reported">none reported</option>
                                            <option value="HILIC"/>
                                            <option value="reverse phase"/>
                                            <option value="other"/>
                                        </param>
                                        <param name="chromatography_instrument" type="select" min="1" label="Chromatography Instrument">
                                            <options from_data_table="isa_cvterms">
                                                <column name="value" index="1"/>
                                                <filter type="static_value" column="2" value="liquid chromatography instrument"/>
                                                <filter type="add_value" value="user_defined_lc_instrument"/>
                                            </options>
                                            <option value="none reported">none reported</option>
                                        </param>
                                        <param name="instrument" type="select" min="1" label="MS Instrument">
                                            <options from_data_table="isa_cvterms">
                                                <column name="value" index="1"/>
                                                <filter type="static_value" column="2" value="mass spectrometry instrument"/>
                                                <filter type="add_value" value="user_defined_ms_instrument"/>
                                            </options>
                                            <option value="none reported">none reported</option>
                                        </param>
                                        <repeat name="acquisitions"  title="Acquisition Series">
                                            <param name="acquisition_mode" type="select" min="1" label="Acquisition Mode">
                                                <option value="negative" selected="True"/>
                                                <option value="positive"/>
                                                <option value="positive/negative"/>
                                            </param>
                                            <param name="technical_replicates" type="integer" label="Number of Technical Replicates" value="1">
                                                <validator type="in_range" message="Technical replicates must be more than 0 and less than 3" min="0" exclude_min="true" max="3"/>
                                            </param>
                                        </repeat>
                                    </when>
                                    <when value="GC">
                                        <param name="chromatography_instrument" type="select"  min="1" label="Chromatography Instrument">
                                            <options from_data_table="isa_cvterms">
                                                <column name="value" index="1"/>
                                                <filter type="static_value" column="2" value="gas chromatography instrument"/>
                                                <filter type="add_value" value="user_defined_gc_instrument"/>
                                            </options>
                                            <option value="none reported">none reported</option>
                                        </param>
                                        <param name="instrument" type="select" min="1" label="MS Instrument">
                                            <options from_data_table="isa_cvterms">
                                                <column name="value" index="1"/>
                                                <filter type="static_value" column="2" value="mass spectrometry instrument"/>
                                                <filter type="add_value" value="user_defined_ms_instrument"/>
                                            </options>
                                            <option value="none reported">none reported</option>
                                        </param>
                                        <repeat name="acquisitions"  title="Acquisition Series">
                                            <param name="acquisition_mode" type="select" min="1" label="Acquisition Mode">
                                                <option value="negative" selected="True"/>
                                                <option value="positive"/>
                                                <option value="positive/negative"/>
                                            </param>
                                            <param name="technical_replicates" type="integer" label="Number of Technical Replicates" value="1">
                                                <validator type="in_range" message="Technical replicates must be more than 0 and less than 3" min="0" exclude_min="true" max="3"/>
                                            </param>
                                        </repeat>
                                        <repeat name="derivatizations" title="Derivatizations">
                                            <param name="derivatization" type="select" label="Derivatization">
                                                <options from_data_table="isa_cvterms">
                                                    <column name="value" index="1"/>
                                                    <filter type="static_value" column="2" value="derivatization"/>
                                                    <filter type="add_value" value="user_defined_derivatization"/>
                                                </options>
                                                <option value="none reported">none reported</option>
                                            </param>
                                        </repeat>
                                    </when>
                                </conditional>
                            </repeat>
                        </when>
                        <when value="nmr">
                            <conditional name="acquisition_mode">
                                <param name="acquisition_mode_selector" type="select" min="1" label="Acquisition Mode">
                                    <option value="1D 1H NMR"/>
                                    <option value="1D 13C NMR"/>
                                    <option value="2D 1H-1H NMR"/>
                                    <option value="2D 13C-13C NMR"/>
                                    <option value="2D 1H-13C NMR"/>
                                </param>
                                <when value="1D 1H NMR">
                                    <param name="nmr_instrument" type="select" min="1" label="NMR Instrument">
                                        <options from_data_table="isa_cvterms">
                                            <column name="value" index="1"/>
                                            <filter type="static_value" column="2" value="NMR instrument"/>
                                            <filter type="add_value" value="user_defined_nmr_instrument"/>
                                        </options>
                                        <option value="none reported">none reported</option>
                                    </param>
                                    <param name="pulse_sequence" type="select"  min="1" label="Pulse Sequence">
                                        <options from_data_table="isa_cvterms">
                                            <column name="value" index="1"/>
                                            <filter type="static_value" column="2" value="1d 1H pulse sequence"/>
                                            <filter type="add_value" value="user_defined_pulse_sequence"/>
                                        </options>
                                        <option value="none reported">none reported</option>
                                    </param>
                                    <param name="magnet" type="text" label="NMR Magnet Power" value="600 Mhz"/>
                                    <param name="technical_replicates" type="integer" label="Number of Technical Replicates" value="1">
                                        <validator type="in_range" message="Technical replicates must be more than 0 and less than 3" min="0" exclude_min="true" max="3"/>
                                    </param>
                                </when>
                                <when value="1D 13C NMR">
                                    <param name="nmr_instrument" type="select" min="1" label="NMR Instrument">
                                        <options from_data_table="isa_cvterms">
                                            <column name="value" index="1"/>
                                            <filter type="static_value" column="2" value="NMR instrument"/>
                                            <filter type="add_value" value="user_defined_nmr_instrument"/>
                                        </options>
                                        <option value="none reported">none reported</option>
                                    </param>
                                    <param name="pulse_sequence" type="select" min="1" label="Pulse Sequence">
                                        <options from_data_table="isa_cvterms">
                                            <column name="value" index="1"/>
                                            <filter type="static_value" column="2" value="1d 13C pulse sequence"/>
                                            <filter type="add_value" value="user_defined_pulse_sequence"/>
                                        </options>
                                        <option value="none reported">none reported</option>
                                    </param>
                                    <param name="magnet" type="text" label="NMR Magnet Power" value="600 Mhz"/>
                                    <param name="technical_replicates" type="integer" label="Number of Technical Replicates" value="1">
                                        <validator type="in_range" message="Technical replicates must be more than 0 and less than 3" min="0" exclude_min="true" max="3"/>
                                    </param>
                                </when>
                                <when value="2D 1H-1H NMR">
                                    <param name="nmr_instrument" type="select" min="1" label="NMR Instrument">
                                        <options from_data_table="isa_cvterms">
                                            <column name="value" index="1"/>
                                            <filter type="static_value" column="2" value="NMR instrument"/>
                                            <filter type="add_value" value="user_defined_nmr_instrument"/>
                                        </options>
                                        <option value="none reported">none reported</option>
                                    </param>
                                    <param name="pulse_seq" type="select" min="1" label="Pulse Sequence">
                                        <options from_data_table="isa_cvterms">
                                            <column name="value" index="1"/>
                                            <filter type="static_value" column="2" value="2d 1H-1H pulse sequence"/>
                                            <filter type="add_value" value="user_defined_pulse_sequence"/>
                                        </options>
                                        <option value="none reported">none reported</option>
                                    </param>
                                    <param name="magnet" type="text" label="NMR Magnet Power" value="600 Mhz"/>
                                    <param name="technical_replicates" type="integer" label="Number of Technical Replicates" value="1">
                                        <validator type="in_range" message="Technical replicates must be more than 0 and less than 3" min="0" exclude_min="true" max="3"/>
                                    </param>
                                </when>
                                <when value="2D 13C-13C NMR">
                                    <param name="nmr_instrument" type="select" min="1" label="NMR Instrument">
                                        <options from_data_table="isa_cvterms">
                                            <column name="value" index="1"/>
                                            <filter type="static_value" column="2" value="NMR instrument"/>
                                            <filter type="add_value" value="user_defined_nmr_instrument"/>
                                        </options>
                                        <option value="none reported">none reported</option>
                                    </param>
                                    <param name="pulse_seq" type="select" min="1" label="Pulse Sequence">
                                        <options from_data_table="isa_cvterms">
                                            <column name="value" index="1"/>
                                            <filter type="static_value" column="2" value="2d 13C-13C pulse sequence"/>
                                            <filter type="add_value" value="user_defined_pulse_sequence"/>
                                        </options>
                                        <option value="none reported">none reported</option>
                                    </param>
                                    <param name="magnet" type="text" label="NMR Magnet Power" value="600 Mhz"/>
                                    <param name="technical_replicates" type="integer" label="Number of Technical Replicates" value="1">
                                        <validator type="in_range" message="Technical replicates must be more than 0 and less than 3" min="0" exclude_min="true" max="3"/>
                                    </param>
                                </when>
                                <when value="2D 1H-13C NMR">
                                    <param name="nmr_instrument" type="select" min="1" label="NMR Instrument">
                                        <options from_data_table="isa_cvterms">
                                            <column name="value" index="1"/>
                                            <filter type="static_value" column="2" value="NMR instrument"/>
                                            <filter type="add_value" value="user_defined_nmr_instrument"/>
                                        </options>
                                        <option value="none reported">none reported</option>
                                    </param>
                                    <param name="pulse_seq" type="select" min="1" label="Pulse Sequence">
                                        <options from_data_table="isa_cvterms">
                                            <column name="value" index="1"/>
                                            <filter type="static_value" column="2" value="2d 1H-13C pulse sequence"/>
                                            <filter type="add_value" value="user_defined_pulse_sequence"/>
                                        </options>
                                        <option value="none reported">none reported</option>
                                    </param>
                                    <param name="magnet" type="text" label="NMR Magnet Power" value="600 Mhz"/>
                                    <param name="technical_replicates" type="integer" label="Number of Technical Replicates" value="1">
                                        <validator type="in_range" message="Technical replicates must be more than 0 and less than 3" min="0" exclude_min="true" max="3"/>
                                    </param>
                                </when>
                            </conditional>
                        </when>
                    </conditional>
                </repeat>
            </repeat>
        </section>
    </xml>

    <xml name="sample_assay_plan_genomics">
        <section name="sample_and_assay_planning" title="Sampling and Assay Plans">
            <repeat name="sample_plans" title="Sampling Plan">
                <param name="material_type" type="select" min="1" label="Sample Material Type">
                    <options from_data_table="isa_cvterms">
                        <column name="value" index="1"/>
                        <filter type="static_value" column="2" value="animal_mat"/>
                        <filter type="add_value" value="user_defined_sample_type"/>
                    </options>
                </param>
                <param name="sample_collections" type="integer" label="Number of Sample Collections" value="1"/>
                <repeat name="assay_plans" title="Assay Plan">
                    <conditional name="assay_type">
                        <param name="assay_type" type="select" label="Assay type">
                            <option value="dna_sequencing">DNA sequencing</option>
                            <option value="dna_microarray" selected="true">DNA microarray</option>
                        </param>
                        <when value="dna_sequencing">
                            <conditional name="platform">
                                <param name="platform_selector" type="select" label="Sequencing Platform">
                                    <option value="454">454</option>
                                    <option value="ab_solid">AB SOLiD</option>
                                    <option value="illumina">Illumina</option>
                                    <option value="ion_torrent">Ion Torrent</option>
                                    <option value="oxford_nanopore">Oxford Nanopore</option>
                                    <option value="pacific_biosciences">Pacific Biosciences</option>
                                </param>
                                <when value="454">
                                    <param name="instrument" type="select" label="Sequencing Instrument">
                                        <option value="454 GS"/>
                                        <option value="454 GS 20"/>
                                        <option value="454 GS FLX"/>
                                        <option value="454 GS FLX Plus"/>
                                        <option value="454 GS FLX Titanium"/>
                                        <option value="454 GS Junior"/>
                                    </param>
                                </when>
                                <when value="ab_solid">
                                    <param name="instrument" type="select" label="Squencing Instrument">
                                        <option value="AB 3730xL Genetic Analyzer"/>
                                        <option value="AB SOLiD System"/>
                                        <option value="AB SOLiD System 2.0"/>
                                        <option value="AB SOLiD System 3.0"/>
                                        <option value="AB SOLiD 3 Plus System"/>
                                        <option value="AB SOLiD 4 System"/>
                                        <option value="AB SOLiD 4hq System"/>
                                        <option value="AB SOLiD 4hq System"/>
                                        <option value="AB SOLiD 5500"/>
                                        <option value="AB SOLiD 5500xl"/>
                                        <option value="AB 5500 Genetic Analyzer"/>
                                        <option value="AB 5500xl Genetic analyzer"/>
                                        <option value="AB 5500xl-W Genetic Analysis System"/>
                                        <option value="AB 3730 Genetic Analyzer"/>
                                        <option value="AB 3500xL Genetic Analyzer"/>
                                        <option value="AB 3500 Genetic Analyzer"/>
                                        <option value="AB 3130xL Genetic Analyzer"/>
                                        <option value="AB 3130 Genetic Analyzer"/>
                                        <option value="AB 310 Genetic Analyzer"/>
                                        <option value="unspecified"/>
                                    </param>
                                </when>
                                <when value="illumina">
                                    <param name="instrument" type="select" label="Sequencing Instrument" help="&lt;`a href='http://purl.obolibrary.org/obo/OBI_0400103'&gt;">
                                        <option value="Illumina Genome Analyzer"/>
                                        <option value="Illumina Genome Analyzer II"/>
                                        <option value="Illumina Genome Analyzer IIx"/>
                                        <option value="Illumina HiSeq 1000"/>
                                        <option value="Illumina HiSeq  2000"/>
                                        <option value="Illumina HiSeq"/>
                                        <option value="Illumina HiSeq 2500"/>
                                        <option value="Illumina HiSeq 3000"/>
                                        <option value="Illumina HiSeq 4000"/>
                                        <option value="Illumina HiScanSQ"/>
                                        <option value="Illumina MiSeq"/>
                                        <option value="HiSeq X Five"/>
                                        <option value="HiSeq X Ten"/>
                                        <option value="NextSeq 500"/>
                                        <option value="NextSeq 550"/>
                                    </param>
                                </when>
                                <when value="ion_torrent">
                                    <param name="instrument" type="select" label="Sequencing Instrument">
                                        <option value="Ion Torrent PGM"/>
                                        <option value="Ion Torrent Proton"/>
                                    </param>
                                </when>
                                <when value="oxford_nanopore">
                                    <param name="instrument" type="select" label="Sequencing Instrument">
                                        <option value="MinION"/>
                                        <option value="GridION"/>
                                    </param>
                                </when>
                                <when value="pacific_biosciences">
                                    <param name="instrument" type="select" label="Sequencing Instrument">
                                        <option value="PacBio RS"/>
                                        <option value="PacBio RS II"/>
                                        <option value="Sequel"/>
                                    </param>
                                </when>
                            </conditional>
                            <param name="library_type" type="select" label="Library Type">
                                <option value="single end"/>
                                <option value="paired end"/>
                            </param>
                            <param name="technical_replicates" type="integer" label="Number of Technical Replicates" value="1">
                                <validator type="in_range" message="Technical replicates must be more than 0 and less than 3" min="0" exclude_min="true" max="3"/>
                            </param>
                        </when>
                        <when value="dna_microarray">
                            <conditional name="array_platform">
                                <param name="array_platform_selector" type="select" label="Sequencing Platform">
                                    <option value="affymetrix"/>
                                    <option value="agilent"/>
                                    <option value="illumina"/>
                                    <option value="other"/>
                                </param>
                                <when value="affymetrix">
                                    <param name="array_design" type="select" label="Array Design">
                                        <option value="Affymetrix 1"/>
                                        <option value="Affymetrix 2"/>
                                    </param>
                                </when>
                                <when value="agilent">
                                    <param name="array_design" type="select" label="Array Design">
                                        <option value="Agilent A"/>
                                        <option value="Agilent B"/>
                                    </param>
                                </when>
                                <when value="illumina">
                                    <param name="array_design" type="select" label="Array Design">
                                        <option value="Illumina A"/>
                                        <option value="Illumina B"/>
                                    </param>
                                </when>
                                <when value="other">
                                    <param name="array_design" type="text" label="User Defined Array Design"/>
                                </when>
                            </conditional>
                            <param name="technical_replicates" type="integer" label="Number of Technical Replicates" value="1">
                                <validator type="in_range" message="Technical replicates must be more than 0 and less than 3" min="0" exclude_min="true" max="3"/>
                            </param>
                        </when>
                    </conditional>
                </repeat>
            </repeat>
        </section>
    </xml>

</macros>